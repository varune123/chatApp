<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src = "clientside-require/dist/bundle.js"></script>

<style>
    h2{
        color:#a71930;
    }
    .deleteButton{
        background-color: #a71930;;
    }
    #messages{
       
        align-items: center;

        width:85%;
        margin: 2px;
        padding: 0px;
        box-sizing: content-box;

        background-color: #4a708b;
        border-radius: 2px;
        position: relative;
        color: white;

        font-size: 16px;
    }
    .chatArea{
        width: 100%;
        display: flex;
        flex-direction: row;
        justify-content: center;
    }
    form{
        width: 100%;
        display: flex;
        flex-direction: row;
        justify-content: center;
    }
    body{
        text-align: center;
        background-color: #00395d;
    }

</style>
</head>



<body>

<script src="/__/firebase/7.14.3/firebase-app.js"></script>
<script src="/__/firebase/7.14.3/firebase-database.js"></script>
<header>
        <h2>Rocket Chat<h2>
        <button onclick="id=changeUsername(userId)" style="position:absolute;right:0px;top:0px;">Change Username</button>
</header>
<script>

  //web app's Firebase configuration
  var config = {
    apiKey: "AIzaSyCUKm3hO1LYem5AifkYNSSRCdvq22Dg1fw",
    authDomain: "chatapp-33234.firebaseapp.com",
    databaseURL: "https://chatapp-33234.firebaseio.com/",
    projectId: "chatapp-33234",
    storageBucket: "chatapp-33234.appspot.com",
    messagingSenderId: "380882548955",
    appId: "1:380882548955:web:8cc29a9a5943ca6324f4fe"
  };
  
  // Initialize Firebase
  firebase.initializeApp(config);
  
  var database= firebase.database();
  var messages= database.ref('messages');
  var myName = prompt("Enter your name");
  var message;
 
  var data={
      name: myName,
      message: message
  };
  
  
  function finished(error){
      if(error){
          console.log("data not saved");
      }else{
          console.log("data saved");
      }
  }


  function sendMessage() {
  // get message
  var time= new Date().toLocaleTimeString();
  time=`<i><span style="font-size:10px;position:absolute;right:0px;">${time}</span></i>`
  message = document.getElementById("message").value + time;

  // save in database
  firebase.database().ref("messages").push().set({
   name: myName,
   message: message
  });
  document.getElementById("message").value="";
  // prevent form from submitting
  return false;
 }

 // listen for incoming messages
 firebase.database().ref("messages").on("child_added", function (snapshot) {
  var html = "";
  //each message's unique ID
  html += "<li id='message-" + snapshot.key + "'>";
   // show delete button if message is sent by me
  if (snapshot.val().name == myName) {
   html += "<button class='deleteButton' data-id='" + snapshot.key + "' onclick='deleteMessage(this);' style='position:static;'>";
    html += "Delete";
   html += "</button>";
  }
  html += snapshot.val().name + ": " + snapshot.val().message;
  html += "</li>";

  document.getElementById("messages").innerHTML += html;
 });


 function deleteMessage(self) {
 // get message ID
 var messageId = self.getAttribute("data-id");

 // delete message
 firebase.database().ref("messages").child(messageId).remove();
}

// attach listener for delete message
firebase.database().ref("messages").on("child_removed", function (snapshot) {
 // remove message node
 document.getElementById("message-" + snapshot.key).innerHTML = "This message has been removed";
});
</script>


<!-- list -->
<div class="chatArea">
<ul id="messages" style="font-size:19px;text-align:left;"></ul>
</div>


<!-- form to send message -->
<form onsubmit="return sendMessage();">
 <input id="message" placeholder="Enter message" autocomplete="off">

 <input type="submit">
</form>


</body>
</html>